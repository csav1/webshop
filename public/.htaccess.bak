# ============================================
# NBA Webshop - Apache URL Rewriting
# ============================================

# URL Rewriting aktivieren
Require all granted
Options +FollowSymLinks -MultiViews
RewriteEngine On

# DirectoryIndex setzen
DirectoryIndex index.php

# Basis-Pfad (anpassen falls in Unterverzeichnis)
RewriteBase /webshop/public/

# ============================================
# Sicherheit
# ============================================

# Zugriff auf versteckte Dateien verhindern (.git, .env, etc.)
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Zugriff auf sensible Dateien verhindern
<FilesMatch "(^#.*#|\.(bak|config|sql|fla|psd|ini|log|sh|inc|swp|dist)|~)$">
    Require all denied
</FilesMatch>

# ============================================
# Performance
# ============================================

# Komprimierung aktivieren (wenn mod_deflate verfügbar)
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser-Caching für statische Dateien
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/font-woff2 "access plus 1 year"
</IfModule>

# ============================================
# URL Rewriting Regeln
# ============================================

# HTTPS erzwingen (in Produktion aktivieren)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# www zu non-www (oder umgekehrt)
# RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
# RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Trailing Slash entfernen (außer bei Verzeichnissen)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} (.+)/$
RewriteRule ^(.+)/$ /$1 [L,R=301]

# Statische Dateien direkt ausliefern
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Verzeichnisse direkt ausliefern
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Front Controller Pattern
# Alle anderen Anfragen an index.php weiterleiten
RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]

# ============================================
# Fehlerseiten (optional)
# ============================================
# ErrorDocument 404 /index.php?url=404
# ErrorDocument 500 /index.php?url=500
